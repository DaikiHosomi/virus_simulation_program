var sketch=function(b){var p,t=screen.availWidth-32,x=Math.floor(.75*t),u=672<screen.availWidth?{width:640,height:480}:{width:t,height:x},y={1:"#ffff00",2:"#ff0000",3:"#00ff00"},e,k=[],z=Math.pow(10,2),g,q,v,r,f={SUSCEPTIBLE:1,INFECTIOUS:2,RECOVERED:3},l={popsize:300,recoveryTimeInMillis:2E3,infectionProbability:1,speed:2};b.getNumberOfBalls=function(){return g};b.getDefaultValues=function(){return l};b.getStatus=function(){return f};b.getStatusArray=function(){for(var a=[],d=0;d<e.length;d++)a[d]=
e[d].status;return a};var w=Math.sqrt(900);b.checkForRecovered=function(){k.forEach(function(a){var d;if(d=void 0!==a.time){d=Date.now()-a.time;var c=1-Math.random();var h=Math.sqrt(-2*Math.log(1-Math.random()));0<.5-Math.random()?(c=h*Math.sin(2*Math.PI*c)*w+q,c=0<c?c:0):(c=h*Math.cos(2*Math.PI*c)*w+q,c=0<c?c:0);d=d>c}d&&(a.time=void 0,e[a.index].status=f.RECOVERED)})};b.setup=function(){p=b.createCanvas(u.width,u.height);p.parent("sirsim-container");b.frameRate(30);this.reset()};b.reset=function(a){p.mouseClicked(function(){var d=
!0,c;return function(){if(d)d=!1,c=Date.now(),b.noLoop(),graph&&graph._setupDone&&graph.noLoop();else{d=!0;var h=Date.now()-c;k.forEach(function(m){m.time&&(m.time+=h)});b.loop();graph&&graph._setupDone&&graph.loop()}}}());playing=!0;b.loop();e=[];k=[];g=a&&a.popsize?a.popsize:l.popsize;q=a&&a.recoveryTimeInMillis?a.recoveryTimeInMillis:l.recoveryTimeInMillis;v=a&&a.infectionProbability?a.infectionProbability:l.infectionProbability;r=a&&a.speed?a.speed:l.speed;for(a=0;a<g;a++)e[a]=new n(b.random(b.width),
b.random(b.height),10,a,e,f.SUSCEPTIBLE);e[g-1].status=f.INFECTIOUS;k.push({time:Date.now(),index:g-1});graph&&graph._setupDone&&graph.reset()};b.draw=function(){b.background(0,87,255);b.checkForRecovered();e.forEach(function(a){b.push();b.noStroke();b.fill(y[a.status]);a.collide();a.move();a.display();b.pop()})};var n=function(a,d,c,h,m,A){this.x=a;this.y=d;this.vx=b.random(-1,1)*r;this.vy=b.random(-1,1)*r;this.diameter=c;this.id=h;this.others=m;this.status=A};n.prototype.collide=function(){for(var a=
0;a<g;a++){var d=this.others[a].x-this.x,c=this.others[a].y-this.y;Math.pow(d,2)+Math.pow(c,2)<z&&(c=b.atan2(c,d),d=this.x+10*b.cos(c),c=this.y+10*b.sin(c),d=.1*(d-this.others[a].x),c=.1*(c-this.others[a].y),this.vx-=d,this.vy-=c,this.others[a].vx+=d,this.others[a].vy+=c,this.checkForStatusChange(a))}};n.prototype.checkForStatusChange=function(a){this.status===f.SUSCEPTIBLE&&this.others[a].status===f.INFECTIOUS&&Math.random()<=v&&(this.status=f.INFECTIOUS,k.push({time:Date.now(),index:this.id}))};
n.prototype.move=function(){this.x+=this.vx;this.y+=this.vy;this.x+this.diameter/2>b.width?(this.x=b.width-this.diameter/2,this.vx*=-1):0>this.x-this.diameter/2&&(this.x=this.diameter/2,this.vx*=-1);this.y+this.diameter/2>b.height?(this.y=b.height-this.diameter/2,this.vy*=-1):0>this.y-this.diameter/2&&(this.y=this.diameter/2,this.vy*=-1)};n.prototype.display=function(){b.circle(this.x,this.y,10)}};