var sketch=function(b){var p,t=screen.availWidth-32,y=Math.floor(.75*t),u=672<screen.availWidth?{width:640,height:480}:{width:t,height:y},z={1:"#ffff00",2:"#ff0000",3:"#00ff00",4:"#000000"},f,m=[],A=Math.pow(10,2),g,q,v,r,w,e={SUSCEPTIBLE:1,INFECTIOUS:2,RECOVERED:3,QUARANTINED:4},h={popsize:300,recoveryTimeInMillis:2E3,infectionProbability:1,speed:2,detectionSuccessRate:.5};b.getNumberOfBalls=function(){return g};b.getDefaultValues=function(){return h};b.getStatus=function(){return e};b.getStatusArray=
function(){for(var a=[],d=0;d<f.length;d++)a[d]=f[d].status;return a};var x=Math.sqrt(900);b.checkForRecovered=function(){m.forEach(function(a){var d;if(d=void 0!==a.time){d=Date.now()-a.time;var c=1-Math.random();var k=Math.sqrt(-2*Math.log(1-Math.random()));0<.5-Math.random()?(c=k*Math.sin(2*Math.PI*c)*x+q,c=0<c?Math.floor(c):0):(c=k*Math.cos(2*Math.PI*c)*x+q,c=0<c?Math.floor(c):0);d=d>c}d&&(a.time=void 0,f[a.index].status=e.RECOVERED)})};b.setup=function(){p=b.createCanvas(u.width,u.height);p.parent("sirsim-container");
b.frameRate(30);this.reset()};b.reset=function(a){p.mouseClicked(function(){var d=!0,c;return function(){if(d)d=!1,c=Date.now(),b.noLoop(),graph&&graph._setupDone&&graph.noLoop();else{d=!0;var k=Date.now()-c;m.forEach(function(n){n.time&&(n.time+=k)});b.loop();graph&&graph._setupDone&&graph.loop()}}}());playing=!0;b.loop();f=[];m=[];g=a&&a.popsize?a.popsize:h.popsize;q=a&&a.recoveryTimeInMillis?a.recoveryTimeInMillis:h.recoveryTimeInMillis;v=a&&a.infectionProbability?a.infectionProbability:h.infectionProbability;
r=a&&a.speed?a.speed:h.speed;w=a&&a.detectionSuccessRate?a.detectionSuccessRate:h.detectionSuccessRate;for(a=0;a<g;a++)f[a]=new l(b.random(b.width),b.random(b.height),10,a,f,e.SUSCEPTIBLE);f[g-1].status=e.INFECTIOUS;m.push({time:Date.now(),index:g-1});graph&&graph._setupDone&&graph.reset()};b.draw=function(){b.background(0,87,255);b.checkForRecovered();f.forEach(function(a){b.push();b.noStroke();b.fill(z[a.status]);a.collide();a.move();a.display();a.checkForINFECTIOUS();b.pop()})};var l=function(a,
d,c,k,n,B){this.x=a;this.y=d;this.vx=b.random(-1,1)*r;this.vy=b.random(-1,1)*r;this.diameter=c;this.id=k;this.others=n;this.status=B};l.prototype.collide=function(){for(var a=0;a<g;a++){var d=this.others[a].x-this.x,c=this.others[a].y-this.y;Math.pow(d,2)+Math.pow(c,2)<A&&(c=b.atan2(c,d),d=this.x+10*b.cos(c),c=this.y+10*b.sin(c),d=.1*(d-this.others[a].x),c=.1*(c-this.others[a].y),this.vx-=d,this.vy-=c,this.others[a].vx+=d,this.others[a].vy+=c,this.checkForStatusChange(a))}};l.prototype.checkForStatusChange=
function(a){this.status===e.SUSCEPTIBLE&&this.others[a].status===e.INFECTIOUS&&Math.random()<=v&&(this.status=e.INFECTIOUS,m.push({time:Date.now(),index:this.id}))};l.prototype.checkForINFECTIOUS=function(){this.status===e.INFECTIOUS&&Math.random()<=w&&(this.status=e.QUARANTINED)};l.prototype.move=function(){this.x+=this.vx;this.y+=this.vy;this.x+this.diameter/2>b.width?(this.x=b.width-this.diameter/2,this.vx*=-1):0>this.x-this.diameter/2&&(this.x=this.diameter/2,this.vx*=-1);this.y+this.diameter/
2>b.height?(this.y=b.height-this.diameter/2,this.vy*=-1):0>this.y-this.diameter/2&&(this.y=this.diameter/2,this.vy*=-1)};l.prototype.display=function(){b.circle(this.x,this.y,10)}};